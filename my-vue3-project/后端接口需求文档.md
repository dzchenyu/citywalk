# my-vue3-project 后端接口需求文档

## 项目概述
my-vue3-project是一个基于Vue3的uni-app城市漫步导航应用，主要功能包括：
- 基于时间选择的城市路线推荐（30分钟/2小时/半天）
- 实时地图导航
- 路线收藏与管理
- 用户位置定位与路线规划

## 接口总览

### 1. 用户相关接口
| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 用户注册 | POST | /api/user/register | 用户注册 |
| 用户登录 | POST | /api/user/login | 用户登录 |
| 用户信息获取 | GET | /api/user/profile | 获取用户信息 |
| 用户信息更新 | PUT | /api/user/profile | 更新用户信息 |

### 2. 路线相关接口
| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取推荐路线 | GET | /api/routes/recommend | 根据时间获取推荐路线 |
| 获取路线详情 | GET | /api/routes/{id} | 获取特定路线详情 |
| 搜索路线 | GET | /api/routes/search | 搜索路线 |
| 获取热门路线 | GET | /api/routes/popular | 获取热门路线 |

### 3. 收藏相关接口
| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取收藏列表 | GET | /api/favorites | 获取用户收藏路线 |
| 添加收藏 | POST | /api/favorites | 收藏路线 |
| 取消收藏 | DELETE | /api/favorites/{id} | 取消收藏路线 |
| 检查收藏状态 | GET | /api/favorites/check/{routeId} | 检查路线是否已收藏 |

### 4. 导航相关接口
| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取导航路线 | POST | /api/navigation/route | 获取两点间导航路线 |
| 获取实时导航 | GET | /api/navigation/realtime | 获取实时导航信息 |
| 保存导航历史 | POST | /api/navigation/history | 保存导航历史 |

### 5. 地点相关接口
| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取附近地点 | GET | /api/places/nearby | 获取附近推荐地点 |
| 获取地点详情 | GET | /api/places/{id} | 获取地点详细信息 |
| 搜索地点 | GET | /api/places/search | 搜索地点 |

## 详细接口说明

### 1. 用户相关接口

#### 1.1 用户注册
- **URL**: `/api/user/register`
- **Method**: `POST`
- **Content-Type**: `application/json`
- **Request Body**:
```json
{
  "username": "string", // 用户名，3-20位
  "email": "string", // 邮箱
  "password": "string", // 密码，6-20位
  "phone": "string" // 手机号，可选
}
```
- **Response**:
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": "string",
    "username": "string",
    "email": "string",
    "token": "string"
  }
}
```

#### 1.2 用户登录
- **URL**: `/api/user/login`
- **Method**: `POST`
- **Content-Type**: `application/json`
- **Request Body**:
```json
{
  "username": "string", // 用户名或邮箱
  "password": "string"
}
```
- **Response**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "userId": "string",
    "username": "string",
    "email": "string",
    "token": "string",
    "avatar": "string"
  }
}
```

#### 1.3 获取用户信息
- **URL**: `/api/user/profile`
- **Method**: `GET`
- **Headers**: `Authorization: Bearer {token}`
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "userId": "string",
    "username": "string",
    "email": "string",
    "phone": "string",
    "avatar": "string",
    "createdAt": "2024-01-01T00:00:00Z",
    "totalWalks": 0,
    "totalDistance": 0
  }
}
```

### 2. 路线相关接口

#### 2.1 获取推荐路线
- **URL**: `/api/routes/recommend`
- **Method**: `GET`
- **Query Parameters**:
  - `duration`: `string` - 时间类型：`30min`, `2h`, `halfday`
  - `lat`: `number` - 当前纬度
  - `lng`: `number` - 当前经度
  - `limit`: `number` - 返回路线数量，默认10
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "id": "route_123",
      "title": "文艺咖啡小径",
      "description": "探索城市中的文艺咖啡馆",
      "duration": "30min",
      "distance": "0.8公里",
      "actualDistance": 0.8,
      "estimatedTime": 15,
      "difficulty": "easy",
      "type": "enhanced-card",
      "routeAngle": 45,
      "startPoint": {
        "lat": 39.90923,
        "lng": 116.397428,
        "name": "当前位置"
      },
      "endPoint": {
        "lat": 39.91523,
        "lng": 116.402428,
        "name": "文艺咖啡馆"
      },
      "waypoints": [
        {
          "lat": 39.91223,
          "lng": 116.399428,
          "name": "中间点1",
          "type": "cafe"
        }
      ],
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg",
        "https://example.com/image3.jpg"
      ],
      "tags": ["文艺", "咖啡", "拍照"],
      "rating": 4.5,
      "reviewCount": 128,
      "isFavorite": false,
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ]
}
```

#### 2.2 获取路线详情
- **URL**: `/api/routes/{id}`
- **Method**: `GET`
- **Path Parameters**:
  - `id`: `string` - 路线ID
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": "route_123",
    "title": "文艺咖啡小径",
    "description": "详细描述...",
    "duration": "30min",
    "distance": "0.8公里",
    "actualDistance": 0.8,
    "estimatedTime": 15,
    "difficulty": "easy",
    "type": "enhanced-card",
    "routeAngle": 45,
    "startPoint": {...},
    "endPoint": {...},
    "waypoints": [...],
    "images": [...],
    "tags": [...],
    "rating": 4.5,
    "reviewCount": 128,
    "isFavorite": false,
    "pois": [
      {
        "id": "poi_001",
        "name": "星巴克咖啡",
        "type": "cafe",
        "lat": 39.91223,
        "lng": 116.399428,
        "address": "北京市朝阳区xxx路xxx号",
        "phone": "010-12345678",
        "rating": 4.2,
        "images": [...],
        "description": "这是一家很有特色的星巴克..."
      }
    ],
    "tips": [
      "建议早上9点后前往",
      "周末人较多，建议避开高峰"
    ],
    "createdAt": "2024-01-01T00:00:00Z"
  }
}
```

#### 2.3 搜索路线
- **URL**: `/api/routes/search`
- **Method**: `GET`
- **Query Parameters**:
  - `keyword`: `string` - 搜索关键词
  - `duration`: `string` - 可选，时间类型
  - `lat`: `number` - 当前纬度
  - `lng`: `number` - 当前经度
  - `radius`: `number` - 搜索半径（公里）
  - `page`: `number` - 页码，默认1
  - `limit`: `number` - 每页数量，默认10
- **Response**:
```json
{
  "code": 200,
  "message": "搜索成功",
  "data": {
    "list": [...], // 路线列表，格式同推荐路线
    "total": 100,
    "page": 1,
    "limit": 10,
    "hasNext": true
  }
}
```

### 3. 收藏相关接口

#### 3.1 获取收藏列表
- **URL**: `/api/favorites`
- **Method**: `GET`
- **Headers**: `Authorization: Bearer {token}`
- **Query Parameters**:
  - `page`: `number` - 页码，默认1
  - `limit`: `number` - 每页数量，默认20
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      {
        "id": "fav_001",
        "route": {
          "id": "route_123",
          "title": "文艺咖啡小径",
          "distance": "0.8公里",
          "duration": "30min",
          "images": [...],
          "rating": 4.5
        },
        "createdAt": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 5,
    "page": 1,
    "limit": 20
  }
}
```

#### 3.2 添加收藏
- **URL**: `/api/favorites`
- **Method**: `POST`
- **Headers**: `Authorization: Bearer {token}`
- **Content-Type**: `application/json`
- **Request Body**:
```json
{
  "routeId": "route_123"
}
```
- **Response**:
```json
{
  "code": 200,
  "message": "收藏成功",
  "data": {
    "id": "fav_001",
    "routeId": "route_123",
    "createdAt": "2024-01-01T00:00:00Z"
  }
}
```

#### 3.3 取消收藏
- **URL**: `/api/favorites/{id}`
- **Method**: `DELETE`
- **Headers**: `Authorization: Bearer {token}`
- **Response**:
```json
{
  "code": 200,
  "message": "取消收藏成功"
}
```

#### 3.4 检查收藏状态
- **URL**: `/api/favorites/check/{routeId}`
- **Method**: `GET`
- **Headers**: `Authorization: Bearer {token}`
- **Response**:
```json
{
  "code": 200,
  "message": "检查成功",
  "data": {
    "isFavorite": true,
    "favoriteId": "fav_001"
  }
}
```

### 4. 导航相关接口

#### 4.1 获取导航路线
- **URL**: `/api/navigation/route`
- **Method**: `POST`
- **Content-Type**: `application/json`
- **Request Body**:
```json
{
  "start": {
    "lat": 39.90923,
    "lng": 116.397428,
    "name": "当前位置"
  },
  "end": {
    "lat": 39.91523,
    "lng": 116.402428,
    "name": "目的地"
  },
  "mode": "walking", // walking, cycling, driving
  "avoid": ["tolls", "highways"] // 可选，避开选项
}
```
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "routeId": "nav_001",
    "distance": 800,
    "duration": 15,
    "path": [
      {
        "lat": 39.90923,
        "lng": 116.397428
      },
      {
        "lat": 39.91023,
        "lng": 116.398428
      }
    ],
    "steps": [
      {
        "instruction": "向东步行100米",
        "distance": 100,
        "duration": 2,
        "direction": "east",
        "position": {
          "lat": 39.90923,
          "lng": 116.397428
        }
      }
    ],
    "traffic": "normal"
  }
}
```

#### 4.2 获取实时导航
- **URL**: `/api/navigation/realtime`
- **Method**: `GET`
- **Query Parameters**:
  - `routeId`: `string` - 路线ID
  - `lat`: `number` - 当前纬度
  - `lng`: `number` - 当前经度
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "currentStep": 3,
    "nextStep": {
      "instruction": "在前方50米左转",
      "distance": 50,
      "direction": "left"
    },
    "remainingDistance": 200,
    "remainingDuration": 5,
    "progress": 75,
    "isArrived": false,
    "traffic": "normal"
  }
}
```

#### 4.3 保存导航历史
- **URL**: `/api/navigation/history`
- **Method**: `POST`
- **Headers**: `Authorization: Bearer {token}`
- **Content-Type**: `application/json`
- **Request Body**:
```json
{
  "routeId": "route_123",
  "startTime": "2024-01-01T09:00:00Z",
  "endTime": "2024-01-01T09:15:00Z",
  "actualDistance": 800,
  "actualDuration": 15,
  "path": [...]
}
```
- **Response**:
```json
{
  "code": 200,
  "message": "保存成功",
  "data": {
    "historyId": "hist_001"
  }
}
```

### 5. 地点相关接口

#### 5.1 获取附近地点
- **URL**: `/api/places/nearby`
- **Method**: `GET`
- **Query Parameters**:
  - `lat`: `number` - 当前纬度
  - `lng`: `number` - 当前经度
  - `radius`: `number` - 搜索半径（米），默认1000
  - `type`: `string` - 地点类型，可选：cafe, restaurant, park, museum, shop
  - `limit`: `number` - 返回数量，默认20
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "id": "poi_001",
      "name": "星巴克咖啡",
      "type": "cafe",
      "lat": 39.91223,
      "lng": 116.399428,
      "address": "北京市朝阳区xxx路xxx号",
      "phone": "010-12345678",
      "rating": 4.2,
      "reviewCount": 156,
      "priceLevel": 2,
      "images": [
        "https://example.com/poi1.jpg"
      ],
      "distance": 200,
      "openNow": true,
      "hours": {
        "open": "08:00",
        "close": "22:00"
      }
    }
  ]
}
```

#### 5.2 获取地点详情
- **URL**: `/api/places/{id}`
- **Method**: `GET`
- **Path Parameters**:
  - `id`: `string` - 地点ID
- **Response**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": "poi_001",
    "name": "星巴克咖啡",
    "type": "cafe",
    "lat": 39.91223,
    "lng": 116.399428,
    "address": "北京市朝阳区xxx路xxx号",
    "phone": "010-12345678",
    "website": "https://www.starbucks.com",
    "rating": 4.2,
    "reviewCount": 156,
    "priceLevel": 2,
    "images": [...],
    "description": "这是一家很有特色的星巴克...",
    "hours": {
      "monday": {"open": "08:00", "close": "22:00"},
      "tuesday": {"open": "08:00", "close": "22:00"},
      ...
    },
    "reviews": [
      {
        "user": "用户A",
        "rating": 5,
        "comment": "环境很好，咖啡很棒",
        "date": "2024-01-01"
      }
    ]
  }
}
```

## 错误码说明

| 错误码 | 描述 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，需要登录 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 429 | 请求过于频繁 |
| 500 | 服务器内部错误 |

## 通用响应格式

所有API响应都遵循以下格式：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {...}
}
```

## 认证方式

- 使用JWT Token进行身份认证
- 在请求头中添加：`Authorization: Bearer {token}`
- Token有效期：7天
- 刷新Token接口：`POST /api/auth/refresh`

## 分页参数

支持分页的接口使用以下参数：
- `page`: 页码，从1开始
- `limit`: 每页数量，最大100

分页响应格式：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "limit": 10,
    "hasNext": true
  }
}
```

## 文件上传

图片上传接口：
- **URL**: `/api/upload/image`
- **Method**: `POST`
- **Content-Type**: `multipart/form-data`
- **Response**:
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "url": "https://cdn.example.com/images/xxx.jpg"
  }
}
